# Инструкции по деплою

## Деплой на Render.com

Проект настроен для автоматического деплоя на Render.com через файл `render.yaml`.

### Настройка на Render.com

1. Создайте новый Web Service на Render.com
2. Подключите ваш GitHub репозиторий
3. Render автоматически обнаружит файл `render.yaml` и применит настройки

### Конфигурация

Проект использует следующие настройки:
- **Environment**: Node.js
- **Build Command**: `npm install`
- **Start Command**: `node server.js`
- **Port**: 10000 (устанавливается через переменную окружения PORT)

### Переменные окружения

В Render.com настроены следующие переменные окружения:
- `NODE_ENV=production`
- `PORT=10000`

### Важные замечания

- Убедитесь, что папка `uploads/` существует (создается автоматически при запуске)
- Файлы загружаются временно и удаляются после обработки
- Статические файлы (CSS, JS) должны находиться в папке `public/`

### Локальный запуск

Для локального запуска используйте:
```bash
npm install
npm start
```

Сервер будет доступен на `http://localhost:3000`

## Деплой через GitHub Actions

Проект включает workflow для автоматического деплоя через GitHub Actions.

### Настройка GitHub Secrets

Для работы деплоя необходимо настроить следующие секреты в настройках репозитория:

1. Перейдите в **Settings** → **Secrets and variables** → **Actions**
2. Нажмите **New repository secret** для каждого секрета

**Обязательные секреты:**

- `SSH_HOST` - IP адрес или домен вашего сервера (например, `192.168.1.100` или `example.com`)
- `SSH_USER` - имя пользователя для SSH подключения (например, `deploy` или `root`)
- `SSH_PRIVATE_KEY` - приватный SSH ключ для подключения к серверу (см. инструкцию ниже)
- `DEPLOY_PATH` - путь к директории проекта на сервере (например, `/var/www/neuroclear-generator`)

**Опциональные секреты:**

- `SSH_PORT` - порт SSH (по умолчанию 22)
- `NODE_ENV` - окружение (по умолчанию `production`)
- `PORT` - порт для приложения (по умолчанию `3000`)

#### Создание SSH ключа

Если у вас еще нет SSH ключа для деплоя:

1. На вашем локальном компьютере создайте новый SSH ключ:
   ```bash
   ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_actions_deploy
   ```

2. Скопируйте публичный ключ на сервер:
   ```bash
   ssh-copy-id -i ~/.ssh/github_actions_deploy.pub user@your-server.com
   ```

3. Скопируйте содержимое приватного ключа:
   ```bash
   cat ~/.ssh/github_actions_deploy
   ```

4. Добавьте весь вывод (включая `-----BEGIN OPENSSH PRIVATE KEY-----` и `-----END OPENSSH PRIVATE KEY-----`) в секрет `SSH_PRIVATE_KEY` в GitHub

**Важно:** Workflow автоматически проверяет наличие всех обязательных секретов и выдаст понятную ошибку, если какой-то секрет не настроен.

### Настройка сервера

1. Установите Node.js (версия 18 или выше) на сервере
2. Установите PM2 для управления процессом:
   ```bash
   npm install -g pm2
   ```
3. Клонируйте репозиторий на сервер:
   ```bash
   git clone <your-repo-url> /var/www/neuroclear-generator
   cd /var/www/neuroclear-generator
   npm install --production
   ```
4. Настройте SSH ключи для доступа без пароля
5. Убедитесь, что папка `uploads/` существует и имеет права на запись

### Автоматический деплой

Workflow автоматически запускается при:
- Push в ветку `main`
- Ручном запуске через GitHub Actions (workflow_dispatch)

### Альтернативные варианты деплоя

Если вы используете другую платформу (Railway, Fly.io, Heroku и т.д.), можно модифицировать workflow файл `.github/workflows/deploy.yml` под ваши нужды.

### Локальное тестирование workflow

Для тестирования деплоя локально можно использовать [act](https://github.com/nektos/act):
```bash
act push
```

## Бесплатные домены и хостинг

### GitHub Pages (только для статических сайтов)

GitHub Pages предоставляет бесплатный поддомен, но **не подходит для Node.js приложений** (только для статических сайтов):

- Бесплатный поддомен: `username.github.io` или `username.github.io/repository-name`
- Подключение кастомного домена: можно подключить свой домен в настройках репозитория

**Ограничение:** GitHub Pages работает только со статическими файлами (HTML, CSS, JS), не поддерживает серверный код Node.js.

### Бесплатные хостинги для Node.js с бесплатными поддоменами

Для Node.js приложений можно использовать следующие бесплатные платформы:

#### 1. **Render.com** (рекомендуется)
- Бесплатный поддомен: `your-app.onrender.com`
- Бесплатный тариф: 750 часов в месяц (достаточно для небольшого проекта)
- Автоматический деплой из GitHub
- Поддержка кастомных доменов (бесплатно)

#### 2. **Railway.app**
- Бесплатный поддомен: `your-app.up.railway.app`
- Бесплатный тариф: $5 кредитов в месяц
- Простой деплой из GitHub
- Поддержка кастомных доменов

#### 3. **Fly.io**
- Бесплатный поддомен: `your-app.fly.dev`
- Бесплатный тариф: 3 shared-cpu-1x VMs
- Глобальная сеть
- Поддержка кастомных доменов

#### 4. **Vercel**
- Бесплатный поддомен: `your-app.vercel.app`
- Бесплатный тариф: для серверных функций
- Отличная производительность
- Поддержка кастомных доменов

#### 5. **Netlify**
- Бесплатный поддомен: `your-app.netlify.app`
- Бесплатный тариф: для серверных функций
- Простой деплой
- Поддержка кастомных доменов

### Бесплатные домены

Если вы хотите использовать собственный домен, можно получить бесплатный:

#### 1. **Freenom** (не рекомендуется для продакшена)
- Предоставляет бесплатные домены `.tk`, `.ml`, `.ga`, `.cf`, `.gq`
- Регистрация: [freenom.com](https://www.freenom.com)
- **Внимание:** Многие провайдеры блокируют эти домены, не рекомендуется для серьезных проектов

#### 2. **No-IP** (динамический DNS)
- Бесплатный поддомен: `yourname.ddns.net`
- Подходит для домашних серверов с динамическим IP
- Регистрация: [noip.com](https://www.noip.com)

#### 3. **DuckDNS**
- Бесплатный поддомен: `yourname.duckdns.org`
- Простая настройка
- Регистрация: [duckdns.org](https://www.duckdns.org)

#### 4. **Cloudflare** (бесплатный DNS + дешевые домены)
- Можно купить домен через Cloudflare по себестоимости (без наценки)
- Бесплатный DNS сервис
- Регистрация: [cloudflare.com](https://www.cloudflare.com)

### Подключение кастомного домена к Render.com

1. В настройках вашего сервиса на Render.com перейдите в раздел **Custom Domains**
2. Добавьте ваш домен
3. Настройте DNS записи у вашего регистратора домена:
   - **CNAME** запись: `www` → `your-app.onrender.com`
   - **A** запись для корневого домена (если поддерживается): IP адрес Render (указан в настройках)

### Рекомендация

Для этого проекта лучше всего использовать **Render.com**:
- Уже настроен файл `render.yaml`
- Бесплатный тариф достаточен для небольших проектов
- Простой деплой из GitHub
- Можно подключить кастомный домен
- Поддержка Node.js приложений
